<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashcam Forensic Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root{--bg:#0d1b2a;--panel:#142233;--accent:#00bcd4;--muted:#98a0a8}
    body{background:var(--bg);color:#eaf6f8;padding:30px;font-family:"Segoe UI",Tahoma,Arial}
    .report-container{background:var(--panel);padding:28px;border-radius:12px;max-width:1100px;margin:auto;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
    h2{color:var(--accent);text-align:center;margin-bottom:6px}
    .meta{color:var(--muted);text-align:center;margin-bottom:18px}
    .section-title{margin-top:20px;margin-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.04);padding-bottom:6px;color:#cfeaf1;font-weight:600}
    table{width:100%;border-collapse:collapse;background:transparent}
    th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);vertical-align:middle;font-size:14px}
    th{background:rgba(0,0,0,0.15);color:#fff;font-weight:700}
    tr:nth-child(even) td{background:rgba(255,255,255,0.02)}
    .btn-pdf{background:var(--accent);color:#062524;padding:10px 18px;border-radius:10px;font-weight:700;text-decoration:none;box-shadow:0 8px 20px rgba(0,188,212,0.08);border:none;}
    .hashbox{word-break:break-all;background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;color:#dff6f8;font-family:monospace;font-size:12px}
    .footnote{color:var(--muted);font-size:13px;margin-top:12px}
    .authentic{color:lightgreen; font-weight: bold;}
    .tampered{color:red; font-weight: bold;}
  </style>
</head>
<body>
  <div class="report-container">
    <h2>ðŸ“‘ Digital Video Forensic Report Preview</h2>
    <div class="meta">
      Case ID: **{{ case_id }}** â€¢ Generated: **{{ report_date }}** â€¢ Prepared by: **{{ prepared_by }}**
    </div>

    <form method="POST" action="{{ url_for('report_generation') }}" class="d-flex justify-content-between align-items-center mb-4">
      <button type="submit" class="btn-pdf">
        <i class="fa fa-file-pdf"></i> GENERATE FINAL PDF REPORT
      </button>
      <div>
          <div class="small text-muted text-end">Last Report Hash (SHA256)</div>
          <div class="hashbox">{{ session.get('last_report_hash','â€”') }}</div>
      </div>
    </form>
    <div class="section-title">1. Evidence Identification (Uploads)</div>
    {% if uploads %}
      <table class="mb-3">
        <thead><tr><th>Filename</th><th>Upload Date</th><th>Hash (Placeholder)</th></tr></thead>
        <tbody>
        {% for u in uploads %}
        <tr>
          <td>{{ u.filename }}</td>
          <td>{{ u.uploaded_at }}</td>
          <td>{{ u.file_hash[:10] + '...' + u.file_hash[-10:] if u.file_hash else 'N/A' }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No uploads recorded.</p>
    {% endif %}

    <div class="section-title">2. Tamper Detection</div>
    {% if tampers %}
      <table class="mb-3">
        <thead><tr><th>Filename</th><th>Status</th><th>Checked At</th></tr></thead>
        <tbody>
        {% for tm in tampers %}
        <tr>
          <td>{{ tm.filename }}</td>
          <td class="{{ 'authentic' if tm.tamper_status == 'Authentic' else 'tampered' }}">
            {{ tm.tamper_status }}
          </td>
          <td>{{ tm.checked_at }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No tamper detection results.</p>
    {% endif %}

    <div class="section-title">3. Timestamp Extraction</div>
    {% if timestamps %}
      <table class="mb-3">
        <thead><tr><th>Filename</th><th>Extracted Timestamp</th><th>Extracted At</th></tr></thead>
        <tbody>
        {% for t in timestamps %}
        <tr><td>{{ t.filename }}</td><td>{{ t.timestamp_text }}</td><td>{{ t.extracted_at }}</td></tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No timestamp extraction results.</p>
    {% endif %}

    <div class="section-title">4. License Plate Recognition</div>
    {% if plates %}
      <table class="mb-3">
        <thead><tr><th>Filename</th><th>Plate</th><th>Confidence</th><th>Detected At</th><th>Crop Image</th></tr></thead>
        <tbody>
        {% for p in plates %}
        <tr>
          <td>{{ p.filename }}</td>
          <td>{{ p.plate_text }}</td>
          <td>{{ '%.2f'|format(p.confidence) if p.confidence is not none else '-' }}</td>
          <td>{{ p.detected_at }}</td>
          <td><img src="{{ p.plate_image_path }}" alt="Plate Crop" style="max-height: 50px; border: 1px solid #333;"></td> 
        </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="text-muted">No license plate results.</p>
    {% endif %}

    <div class="text-center mt-4">
      <a href="{{ url_for('dashboard') }}" class="btn-pdf" style="background:#3b3f45">â¬… Back to Dashboard</a>
    </div>

    <div class="footnote mt-3">**Note:** This is a live preview. The formal PDF generated by clicking the button above will serve as the official record.</div>
  </div>
</body>
</html>